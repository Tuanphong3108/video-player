<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√¨nh Ph√°t Video</title>
    <!-- T·∫£i Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- T·∫£i Material Symbols (Outline, Fill, Weight) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
    <!-- === PWA MANIFEST & FILE HANDLING === -->
    <!-- Manifest ƒë∆∞·ª£c li√™n k·∫øt ƒë·∫øn file manifest.json ri√™ng bi·ªát, c·∫ßn thi·∫øt cho GitHub Pages v√† PWA ch√≠nh th·ª©c. -->
    <link rel="manifest" href="manifest.json">
    
    <style>
        /* Thi·∫øt l·∫≠p font Inter cho to√†n b·ªô ·ª©ng d·ª•ng */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* T·ªëi ∆∞u thanh cu·ªôn */
        .scrollbar-thin::-webkit-scrollbar {
            width: 8px;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: #4a5568;
            border-radius: 4px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #2d3748;
        }
        /* Styling cho thanh Range Slider (Ti·∫øn tr√¨nh) */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: #3b82f6; /* accent */
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 2px rgba(0,0,0,0.5);
        }
        input[type=range]::-moz-range-thumb {
            width: 12px;
            height: 12px;
            background: #3b82f6; /* accent */
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 2px rgba(0,0,0,0.5);
            border: none;
        }

        /* Animation cho Drag & Drop Overlay */
        #drag-overlay {
            transition: opacity 0.3s ease-in-out;
        }

        /* --- MATERIAL SYMBOLS STYLING --- */
        .material-symbols-outlined {
            /* Set default state: Outline (FILL=0) */
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            transition: font-variation-settings 0.3s ease; /* Smooth transition for the effect */
            line-height: 1; /* Fix vertical alignment */
            display: inline-block;
        }
        
        /* Apply FILL=1 (Filled) when the parent button group is hovered */
        .group:hover .material-symbols-outlined,
        /* Also apply FILL=1 when the button is focused (for keyboard navigation) */
        .group:focus-visible .material-symbols-outlined {
            font-variation-settings: 'FILL' 1, 'wght' 600, 'GRAD' 0, 'opsz' 24;
        }
    </style>
    <script>
        // C·∫•u h√¨nh Tailwind CSS: B·∫≠t dark mode v√† m√†u s·∫Øc c∆° b·∫£n
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'background-dark': '#1f2937', // Grey 800
                        'card-dark': '#374151',      // Grey 700
                        'accent': '#3b82f6',         // Blue 500
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="p-4 bg-gray-800 shadow-lg flex justify-between items-center z-10">
        <h1 class="text-2xl font-bold text-white">Tr√¨nh Ph√°t Video T·ªëi Gi·∫£n üé•</h1>
        <label for="fileInput" class="cursor-pointer bg-accent hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105">
            Ch·ªçn Video
        </label>
        <input type="file" id="fileInput" accept="video/*" class="hidden" onchange="handleFileSelect(event)">
    </header>

    <!-- Main Content Area - Video Player takes full width -->
    <main class="flex-grow flex flex-col overflow-hidden">
        
        <!-- Video Player Area (Container) -->
        <div id="video-container" class="w-full p-4 flex flex-col items-center justify-center bg-background-dark relative flex-grow">

            <!-- Video Wrapper (Contains video and controls) -->
            <div id="video-wrapper" class="w-full max-w-5xl h-full max-h-[85vh] rounded-xl shadow-2xl bg-black border border-gray-700 relative overflow-hidden hidden">
                <!-- Lo·∫°i b·ªè 'controls' m·∫∑c ƒë·ªãnh c·ªßa tr√¨nh duy·ªát -->
                <video id="videoPlayer" class="w-full h-full object-contain"></video>
                
                <!-- Custom Controls Overlay (·∫®n ƒëi khi kh√¥ng ho·∫°t ƒë·ªông) -->
                <div id="controls-overlay" class="absolute inset-0 flex flex-col items-center justify-end transition-opacity duration-300 opacity-0 pointer-events-none p-4">
                    <div id="customControls" class="w-full bg-gray-900/90 backdrop-blur-sm p-3 rounded-xl shadow-2xl border border-gray-700 flex flex-col pointer-events-auto">
                        
                        <!-- Seek Bar / Progress Bar -->
                        <input type="range" id="progressBar" value="0" min="0" max="100" class="w-full h-1 appearance-none cursor-pointer bg-accent/50 rounded-full">

                        <!-- Control Buttons Row -->
                        <div class="flex items-center justify-between mt-2">
                            
                            <!-- Left Controls: Play/Skip/Time -->
                            <div class="flex items-center space-x-3">
                                
                                <!-- Skip Backward 10s -->
                                <button id="skipBackwardBtn" title="Tua l√πi 10s" class="p-2 text-gray-300 hover:text-white rounded-full transition duration-150 transform hover:scale-110 group">
                                    <span class="material-symbols-outlined text-2xl">replay_10</span>
                                </button>
                                
                                <!-- Play/Pause Button -->
                                <button id="playPauseBtn" title="Play/Pause" class="p-2 text-white bg-accent hover:bg-blue-600 rounded-full transition duration-150 transform hover:scale-110 group">
                                    <span id="playPauseIcon" class="material-symbols-outlined text-3xl">play_arrow</span>
                                </button>
                                
                                <!-- Skip Forward 10s -->
                                <button id="skipForwardBtn" title="Tua ti·∫øn 10s" class="p-2 text-gray-300 hover:text-white rounded-full transition duration-150 transform hover:scale-110 group">
                                    <span class="material-symbols-outlined text-2xl">forward_10</span>
                                </button>

                                <!-- Time Display -->
                                <div id="timeDisplay" class="text-sm font-mono text-gray-300 hidden md:block">00:00 / 00:00</div>
                            </div>

                            <!-- Right Controls: Speed, Loop, PiP, Volume, Fullscreen -->
                            <div class="flex items-center space-x-3">
                                
                                <!-- Speed Control -->
                                <div class="relative group">
                                    <button id="speedBtn" class="p-2 text-gray-300 hover:text-white rounded-lg text-sm font-semibold transition duration-150 bg-gray-800/50">
                                        1.0x
                                    </button>
                                    <!-- Speed Menu -->
                                    <div id="speedMenu" class="absolute bottom-full mb-2 right-0 bg-gray-900 border border-gray-700 rounded-lg shadow-xl overflow-hidden hidden w-20">
                                    </div>
                                </div>
                                
                                <!-- Loop Button -->
                                <button id="loopBtn" title="L·∫∑p l·∫°i" class="p-2 text-gray-500 hover:text-accent rounded-full transition duration-150 group">
                                    <span class="material-symbols-outlined text-xl">repeat</span>
                                </button>

                                <!-- Picture-in-Picture Button (Ch·ªâ hi·ªán n·∫øu tr√¨nh duy·ªát h·ªó tr·ª£) -->
                                <button id="pipBtn" title="H√¨nh trong h√¨nh" class="p-2 text-gray-300 hover:text-white rounded-full transition duration-150 hidden group">
                                    <span class="material-symbols-outlined text-xl">picture_in_picture_alt</span>
                                </button>
                                
                                <!-- Volume Control (Hi·ªán Slider khi hover) -->
                                <div class="flex items-center space-x-2 group relative">
                                    <!-- Volume Slider -->
                                    <input type="range" id="volumeSlider" value="100" min="0" max="100" title="√Çm l∆∞·ª£ng" class="w-20 h-1 appearance-none cursor-pointer bg-gray-700 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 hidden md:block">
                                    <!-- Volume Button -->
                                    <button id="volumeBtn" title="T·∫Øt/M·ªü ti·∫øng" class="p-2 text-gray-300 hover:text-white rounded-full transition duration-150 group">
                                        <span id="volumeIcon" class="material-symbols-outlined text-xl">volume_up</span>
                                    </button>
                                </div>

                                <!-- Fullscreen Button -->
                                <button id="fullscreenBtn" title="To√†n m√†n h√¨nh" class="p-2 text-gray-300 hover:text-white rounded-full transition duration-150 group">
                                    <span id="fullscreenIcon" class="material-symbols-outlined text-xl">fullscreen</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Custom Controls Overlay -->
            </div>
            <!-- End Video Wrapper -->
            
            <div id="placeholder" class="text-center text-gray-400 p-8 rounded-xl border-2 border-dashed border-gray-700 bg-gray-800 transition duration-300 flex flex-col items-center justify-center w-full max-w-lg h-64">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
                <p class="text-lg font-medium">K√©o & Th·∫£ Video Ho·∫∑c</p>
                <p class="text-sm mt-1">Nh·∫•n "Ch·ªçn Video" ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
                <p class="text-xs mt-3 text-yellow-400">üö® ƒê·ªÉ M·ªü File Tr·ª±c Ti·∫øp: C√†i ƒë·∫∑t ·ª©ng d·ª•ng PWA n√†y qua tr√¨nh duy·ªát!</p>
            </div>
            
            <div id="currentVideoInfo" class="mt-4 text-sm text-gray-400"></div>
        </div>

    </main>
    
    <!-- Drag & Drop Visual Overlay -->
    <div id="drag-overlay" class="fixed inset-0 bg-accent/30 backdrop-blur-sm z-50 pointer-events-none opacity-0 flex items-center justify-center border-4 border-dashed border-accent rounded-xl m-4">
        <p class="text-3xl font-bold text-white shadow-lg p-4 bg-accent/70 rounded-lg">TH·∫¢ VIDEO V√ÄO ƒê√ÇY</p>
    </div>

    <script>
        // Global variables
        const videoPlayer = document.getElementById('videoPlayer');
        const placeholder = document.getElementById('placeholder');
        const currentVideoInfo = document.getElementById('currentVideoInfo');
        const videoWrapper = document.getElementById('video-wrapper');
        const controlsOverlay = document.getElementById('controls-overlay');
        const dragOverlay = document.getElementById('drag-overlay');

        // New Global variables for custom controls
        const playPauseBtn = document.getElementById('playPauseBtn');
        const playPauseIcon = document.getElementById('playPauseIcon'); // Material Symbol Span
        const progressBar = document.getElementById('progressBar');
        const timeDisplay = document.getElementById('timeDisplay');
        const volumeBtn = document.getElementById('volumeBtn');
        const volumeIcon = document.getElementById('volumeIcon'); // Material Symbol Span
        const volumeSlider = document.getElementById('volumeSlider');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const fullscreenIcon = document.getElementById('fullscreenIcon'); // Material Symbol Span
        
        // New Control elements
        const skipBackwardBtn = document.getElementById('skipBackwardBtn');
        const skipForwardBtn = document.getElementById('skipForwardBtn');
        const speedBtn = document.getElementById('speedBtn');
        const speedMenu = document.getElementById('speedMenu');
        const loopBtn = document.getElementById('loopBtn');
        const pipBtn = document.getElementById('pipBtn');

        let currentFileURL = null; // Ch·ªâ l∆∞u tr·ªØ URL c·ªßa video ƒëang ph√°t
        let controlsTimeout;
        const defaultPlaybackRate = 1.0;
        
        // --- UTILITY FUNCTIONS ---

        /**
         * ƒê·ªãnh d·∫°ng th·ªùi gian t·ª´ gi√¢y sang MM:SS.
         */
        function formatTime(seconds) {
            if (isNaN(seconds) || seconds < 0) return '00:00';
            const minutes = Math.floor(seconds / 60);
            const remainderSeconds = Math.floor(seconds % 60);
            const paddedMinutes = String(minutes).padStart(2, '0');
            const paddedSeconds = String(remainderSeconds).padStart(2, '0');
            return `${paddedMinutes}:${paddedSeconds}`;
        }

        /**
         * Hi·ªÉn th·ªã Controls Overlay v√† thi·∫øt l·∫≠p h·∫πn gi·ªù ·∫©n.
         */
        function showControls() {
            if (videoWrapper.classList.contains('hidden')) return;
            
            controlsOverlay.classList.remove('opacity-0');
            clearTimeout(controlsTimeout);
            
            // ·∫®n controls sau 3 gi√¢y n·∫øu video ƒëang ph√°t
            if (!videoPlayer.paused) {
                controlsTimeout = setTimeout(() => {
                    controlsOverlay.classList.add('opacity-0');
                }, 3000);
            }
        }

        /**
         * ·∫®n Controls Overlay.
         */
        function hideControls() {
            clearTimeout(controlsTimeout);
            controlsOverlay.classList.add('opacity-0');
        }

        // --- CORE APPLICATION LOGIC ---

        /**
         * T·∫£i v√† b·∫Øt ƒë·∫ßu ph√°t video t·ª´ File object.
         */
        function loadVideoFromFile(file) {
            // Thu h·ªìi URL c≈© ƒë·ªÉ tr√°nh r√≤ r·ªâ b·ªô nh·ªõ
            if (currentFileURL) {
                URL.revokeObjectURL(currentFileURL);
            }

            const objectURL = URL.createObjectURL(file);
            currentFileURL = objectURL;
            videoPlayer.src = currentFileURL;
            videoPlayer.load();

            // Reset t·ªëc ƒë·ªô ph√°t v·ªÅ m·∫∑c ƒë·ªãnh
            videoPlayer.playbackRate = defaultPlaybackRate;
            speedBtn.textContent = `${defaultPlaybackRate.toFixed(1)}x`;

            // C·∫≠p nh·∫≠t giao di·ªán: ·∫®n placeholder, hi·ªán video wrapper
            placeholder.classList.add('hidden');
            videoWrapper.classList.remove('hidden');
            
            // Hi·ªán controls khi video ƒë∆∞·ª£c t·∫£i
            showControls(); 

            videoPlayer.play().catch(e => {
                console.warn("L·ªói t·ª± ƒë·ªông ph√°t: " + e.message);
                currentVideoInfo.textContent = `‚ñ∂Ô∏è ƒê√£ t·∫£i: ${file.name}. Vui l√≤ng nh·∫•n n√∫t Play.`;
                showControls();
            });
            
            currentVideoInfo.textContent = `ƒêang ph√°t: ${file.name}`;
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i PiP
            if ('pictureInPictureEnabled' in document && document.pictureInPictureEnabled) {
                pipBtn.classList.remove('hidden');
            }
        }
        
        // --- DRAG & DROP LOGIC ---

        function handleFileDrop(e) {
            e.preventDefault();
            dragOverlay.classList.add('opacity-0');
            
            const files = e.dataTransfer.files;
            
            // Ch·ªâ ch·∫•p nh·∫≠n file video ƒë·∫ßu ti√™n
            const videoFile = Array.from(files).find(file => file.type.startsWith('video/'));

            if (videoFile) {
                loadVideoFromFile(videoFile);
            } else {
                currentVideoInfo.textContent = "‚ùå L·ªói: Vui l√≤ng th·∫£ m·ªôt file video h·ª£p l·ªá.";
            }
        }
        
        // Visual feedback cho Drag & Drop
        document.body.addEventListener('dragover', (e) => {
            e.preventDefault();
            dragOverlay.classList.remove('opacity-0');
        });

        document.body.addEventListener('dragleave', (e) => {
            // Ch·ªâ ·∫©n n·∫øu kh√¥ng di chu·ªôt v√†o b·∫•t k·ª≥ ph·∫ßn t·ª≠ con n√†o kh√°c
            if (e.clientX === 0 && e.clientY === 0) {
                 dragOverlay.classList.add('opacity-0');
            }
        });
        
        document.body.addEventListener('drop', handleFileDrop);

        // X·ª≠ l√Ω t·ª´ n√∫t Ch·ªçn File
        function handleFileSelect(event) {
            const files = event.target.files;
            if (files.length > 0) {
                loadVideoFromFile(files[0]);
            }
        }

        // --- CUSTOM CONTROLS LOGIC ---
        
        // 1. Skip Forward/Backward
        function skip(seconds) {
            if (!videoPlayer.src) return;
            videoPlayer.currentTime += seconds;
            showControls();
        }
        skipBackwardBtn.addEventListener('click', () => skip(-10));
        skipForwardBtn.addEventListener('click', () => skip(10));
        
        // 2. Playback Speed
        const speedRates = [0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0];

        function setPlaybackSpeed(speed) {
            videoPlayer.playbackRate = speed;
            speedBtn.textContent = `${speed.toFixed(2).replace(/\.00$/, '.0')}x`;
            speedMenu.classList.add('hidden');
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i menu: x√≥a active c≈©, th√™m active m·ªõi
            Array.from(speedMenu.children).forEach(item => {
                if (parseFloat(item.dataset.speed) === speed) {
                    item.classList.add('bg-accent', 'text-white');
                    item.classList.remove('hover:bg-gray-700', 'text-gray-300');
                } else {
                    item.classList.remove('bg-accent', 'text-white');
                    item.classList.add('hover:bg-gray-700', 'text-gray-300');
                }
            });
            showControls();
        }

        function setupSpeedMenu() {
            speedRates.forEach(rate => {
                const item = document.createElement('div');
                item.className = 'p-2 text-sm text-gray-300 cursor-pointer transition duration-100 text-center';
                item.textContent = `${rate.toFixed(2).replace(/\.00$/, '.0')}x`;
                item.dataset.speed = rate;
                item.onclick = () => setPlaybackSpeed(rate);

                // Kh·ªüi t·∫°o tr·∫°ng th√°i active cho 1.0x
                if (rate === 1.0) {
                    item.classList.add('bg-accent', 'text-white');
                } else {
                    item.classList.add('hover:bg-gray-700');
                }
                speedMenu.appendChild(item);
            });
            
            speedBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // NgƒÉn click lan ra ngo√†i
                speedMenu.classList.toggle('hidden');
                showControls();
            });

            // ·∫®n menu khi click ra ngo√†i
            document.addEventListener('click', (e) => {
                if (!speedBtn.contains(e.target) && !speedMenu.contains(e.target)) {
                    speedMenu.classList.add('hidden');
                }
            });
        }
        
        // 3. Loop Toggle
        function toggleLoop() {
            videoPlayer.loop = !videoPlayer.loop;
            const loopIcon = loopBtn.querySelector('.material-symbols-outlined');
            
            if (videoPlayer.loop) {
                loopBtn.classList.add('text-accent', 'ring-2', 'ring-accent');
                loopBtn.classList.remove('text-gray-500');
                loopIcon.style.fontVariationSettings = "'FILL' 1, 'wght' 600, 'GRAD' 0, 'opsz' 24"; // Force Fill
                currentVideoInfo.textContent = `üîÅ B·∫≠t ch·∫ø ƒë·ªô L·∫∑p l·∫°i.`;
            } else {
                loopBtn.classList.remove('text-accent', 'ring-2', 'ring-accent');
                loopBtn.classList.add('text-gray-500');
                loopIcon.style.fontVariationSettings = "initial"; // Reset to default (Outline)
                currentVideoInfo.textContent = `üîÇ T·∫Øt ch·∫ø ƒë·ªô L·∫∑p l·∫°i.`;
            }
            showControls();
        }
        loopBtn.addEventListener('click', toggleLoop);
        
        // 4. Picture-in-Picture (PiP)
        pipBtn.addEventListener('click', () => {
             if (!videoPlayer.src) return;
             togglePiP();
        });
        
        function togglePiP() {
            if (!document.pictureInPictureElement) {
                videoPlayer.requestPictureInPicture().catch(err => {
                    console.error("L·ªói PiP: ", err);
                    currentVideoInfo.textContent = "üö´ L·ªói: Tr√¨nh duy·ªát kh√¥ng cho ph√©p PiP ho·∫∑c ƒëang b·ªã ch·∫∑n.";
                });
            } else {
                document.exitPictureInPicture().catch(err => {
                    console.error("L·ªói tho√°t PiP: ", err);
                });
            }
            showControls();
        }
        
        // 5. Fullscreen
        fullscreenBtn.addEventListener('click', () => {
            if (!videoPlayer.src) return;
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                videoWrapper.requestFullscreen().catch(err => {
                    console.error(`L·ªói Fullscreen: ${err.message} (${err.name})`);
                    currentVideoInfo.textContent = `üö´ L·ªói: Tr√¨nh duy·ªát ch·∫∑n ch·∫ø ƒë·ªô to√†n m√†n h√¨nh.`;
                });
            }
        });
        
        // --- EVENT LISTENERS (UPDATE MATERIAL SYMBOLS) ---

        // Controls visibility
        videoWrapper.addEventListener('mousemove', showControls);
        videoWrapper.addEventListener('mouseenter', showControls);
        videoWrapper.addEventListener('mouseleave', () => {
            if (!videoPlayer.paused) {
                hideControls();
            }
        });
        
        // Play/Pause Toggle
        function togglePlayPause() {
            if (!videoPlayer.src) return;
            if (videoPlayer.paused || videoPlayer.ended) {
                videoPlayer.play().catch(e => console.error("L·ªói Play: ", e));
            } else {
                videoPlayer.pause();
            }
        }
        playPauseBtn.addEventListener('click', togglePlayPause);
        videoPlayer.addEventListener('click', (event) => {
            if (event.target.closest('#customControls')) { return; }
            togglePlayPause();
        });

        // Icon updates
        videoPlayer.addEventListener('play', () => {
            playPauseIcon.textContent = 'pause'; // Pause icon
            setTimeout(hideControls, 1000); 
        });
        videoPlayer.addEventListener('pause', () => {
            playPauseIcon.textContent = 'play_arrow'; // Play icon
            showControls();
        });
        
        // Fullscreen Icon update
        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                fullscreenIcon.textContent = 'fullscreen_exit';
            } else {
                fullscreenIcon.textContent = 'fullscreen';
            }
        });
        
        // Time and Progress Bar Update (Gi·ªØ nguy√™n)
        videoPlayer.addEventListener('loadedmetadata', () => {
            progressBar.max = videoPlayer.duration;
            timeDisplay.textContent = `${formatTime(0)} / ${formatTime(videoPlayer.duration)}`;
            volumeSlider.value = videoPlayer.volume * 100;
            updateVolumeIcon(videoPlayer.volume, videoPlayer.muted);
        });

        videoPlayer.addEventListener('timeupdate', () => {
            if (document.activeElement !== progressBar) {
                progressBar.value = videoPlayer.currentTime;
            }
            timeDisplay.textContent = `${formatTime(videoPlayer.currentTime)} / ${formatTime(videoPlayer.duration)}`;
        });

        progressBar.addEventListener('input', () => {
            if (!isNaN(videoPlayer.duration) && videoPlayer.duration > 0) {
                videoPlayer.currentTime = progressBar.value;
            }
            showControls(); 
        });
        
        // Volume Control (UPDATE Material Symbols Logic)
        function updateVolumeIcon(volume, isMuted) {
            let iconName = 'volume_up';
            if (isMuted || volume === 0) {
                iconName = 'volume_off';
            } else if (volume > 0.5) {
                iconName = 'volume_up';
            } else {
                iconName = 'volume_down';
            }
            volumeIcon.textContent = iconName;
        }

        volumeSlider.addEventListener('input', () => {
            const volume = volumeSlider.value / 100;
            videoPlayer.volume = volume;
            videoPlayer.muted = false;
            updateVolumeIcon(volume, videoPlayer.muted);
        });

        volumeBtn.addEventListener('click', () => {
            videoPlayer.muted = !videoPlayer.muted;
            updateVolumeIcon(videoPlayer.volume, videoPlayer.muted);
            if (!videoPlayer.muted && videoPlayer.volume === 0) {
                videoPlayer.volume = 0.5;
                volumeSlider.value = 50;
                updateVolumeIcon(videoPlayer.volume, videoPlayer.muted);
            }
        });
        
        // Kh·ªüi t·∫°o menu t·ªëc ƒë·ªô
        setupSpeedMenu();

        // ƒê·∫£m b·∫£o r·∫±ng URL object b·ªã thu h·ªìi khi trang b·ªã ƒë√≥ng
        window.addEventListener('beforeunload', () => {
            if (currentFileURL) {
                URL.revokeObjectURL(currentFileURL);
            }
        });
        
        // --- PWA FILE HANDLING LOGIC ---
        // X·ª≠ l√Ω file ƒë∆∞·ª£c truy·ªÅn v√†o khi ·ª©ng d·ª•ng ƒë∆∞·ª£c m·ªü b·∫±ng c√°ch nh·∫•n ƒë√∫p v√†o file video.
        if ('launchQueue' in window) {
            console.log('[File Handler] API supported. Setting consumer...');
            window.launchQueue.setConsumer(async (launchParams) => {
                // Ki·ªÉm tra xem c√≥ file n√†o ƒë∆∞·ª£c truy·ªÅn v√†o kh√¥ng
                if (launchParams.files && launchParams.files.length > 0) {
                    console.log('[File Handler] File(s) received.');
                    
                    // L·∫•y handle c·ªßa file ƒë·∫ßu ti√™n
                    const fileHandle = launchParams.files[0];
                    
                    try {
                        // L·∫•y ƒë·ªëi t∆∞·ª£ng File th·ª±c s·ª±
                        const file = await fileHandle.getFile();
                        
                        // T·∫£i v√† ph√°t video
                        loadVideoFromFile(file);
                        currentVideoInfo.textContent = `üé¨ ƒêang m·ªü file qua desktop: ${file.name}`;
                    } catch (error) {
                        console.error('L·ªói khi truy c·∫≠p File Handle:', error);
                        currentVideoInfo.textContent = 'üö´ L·ªói khi c·ªë g·∫Øng m·ªü file.';
                    }
                } else {
                    console.log('[File Handler] App launched without files.');
                }
            });
        } else {
            console.log('[File Handler] API not supported or PWA not installed.');
        }

        // --- SERVICE WORKER REGISTRATION (ƒêƒÉng k√Ω S∆∞ Ph·ª•) ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker: ƒêƒÉng k√Ω th√†nh c√¥ng v·ªõi scope:', reg.scope))
                    .catch(err => console.error('Service Worker: ƒêƒÉng k√Ω th·∫•t b·∫°i:', err));
            });
        }
    </script>
</body>
</html>
